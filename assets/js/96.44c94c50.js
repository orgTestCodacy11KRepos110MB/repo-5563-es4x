(window.webpackJsonp=window.webpackJsonp||[]).push([[96],{472:function(a,e,t){"use strict";t.r(e);var s=t(42),n=Object(s.a)({},(function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"package"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#package"}},[a._v("#")]),a._v(" Package")]),a._v(" "),t("p",[a._v("Spakowane aplikacje powinny trzymać się konwencji "),t("code",[a._v("NPM")]),a._v(":")]),a._v(" "),t("div",{staticClass:"language-sh extra-class"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" pack\n")])])]),t("p",[t("a",{attrs:{href:"https://docs.npmjs.com/cli/pack",target:"_blank",rel:"noopener noreferrer"}},[a._v("npm pack"),t("OutboundLink")],1),a._v(" wyprodukuje plik "),t("code",[a._v("TGZ")]),a._v(" z aplikacją, który możesz przenosić do innych\nlokalizacji. Oprócz tego aplikacje mogą być również "),t("a",{attrs:{href:"https://docs.npmjs.com/cli/publish",target:"_blank",rel:"noopener noreferrer"}},[a._v("publikowane"),t("OutboundLink")],1),a._v(" w rejestrach NPM.")]),a._v(" "),t("p",[a._v("Ważnym jest, by zauważyć, że aby "),t("code",[a._v("opublikowane/spakowane")]),a._v(" aplikacje działały na docelowym środowisku musi mieć ono\ndostęp do paczki "),t("a",{attrs:{href:"https://www.npmjs.com/package/@es4x/create",target:"_blank",rel:"noopener noreferrer"}},[a._v("@es4x/create"),t("OutboundLink")],1),a._v(", która jest wymagana do instalacji kawałków\n"),t("code",[a._v("javy")]),a._v(".")]),a._v(" "),t("h2",{attrs:{id:"docker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker"}},[a._v("#")]),a._v(" Docker")]),a._v(" "),t("p",[a._v("Z aplikacji można tworzyć również obrazy dockerowe.")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("es4x dockerfile\n")])])]),t("p",[a._v("Ta komenda wyprodukuje prosty "),t("code",[a._v("dockerfile")]),a._v(", który możesz konfigurować według własnych potrzeb. Domyślnie plik będzie 3\netapem builda.")]),a._v(" "),t("ol",[t("li",[a._v("W pierwszym etapie używany jest "),t("code",[a._v("node")]),a._v(" do instalacji wszystkich dependencji "),t("code",[a._v("NPM")]),a._v(".")]),a._v(" "),t("li",[a._v("W drugim etapie używana jest "),t("code",[a._v("java")]),a._v(" do instalacji dependencji "),t("code",[a._v("Mavena")]),a._v(".")]),a._v(" "),t("li",[a._v("W końcowym etapie obraz GraalVM jest używany do uruchomienia programu.")])]),a._v(" "),t("p",[a._v("Domyślnie używany jest obraz dockera "),t("a",{attrs:{href:"https://hub.docker.com/r/oracle/graalvm-ce",target:"_blank",rel:"noopener noreferrer"}},[a._v("oracle/graalvm-ce"),t("OutboundLink")],1),a._v(". Można go jednak\nzastąpić każdym innym obrazem JDK (najlepiej wersji 11 lub wyższej), który wspiera JVMCI.")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("docker build "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v(" --build-arg "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("BASEIMAGE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("openjdk:11\n")])])]),t("h2",{attrs:{id:"jlink"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#jlink"}},[a._v("#")]),a._v(" JLink")]),a._v(" "),t("p",[a._v("Java 11 wspiera "),t("a",{attrs:{href:"https://docs.oracle.com/en/java/javase/11/tools/jlink.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("jlink"),t("OutboundLink")],1),a._v(". Możesz użyć jlink do złożenia i\noptymalizacji modułów oraz ich dependencji w spersonalizowany obraz runtime.")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("es4x jlink\n")])])]),t("p",[a._v("Komenda stworzy "),t("strong",[a._v("zoptymalizowany")]),a._v(" runtime, co znaczy że może on być użyty zamiast pełnej instalacji JDK.\nDla porównania, program hello world stworzy plik ważący około "),t("strong",[a._v("80Mb")]),a._v(", podczas gdy pełna instalacja JDK wymaga około\n"),t("strong",[a._v("200Mb")]),a._v(".")]),a._v(" "),t("p",[a._v("Ta funkcjonalność może być użyta łącznie z "),t("code",[a._v("Dockerfile")]),a._v(". Zamiast używania podstawowego obrazu graal, użyj postawowego\nobrazu "),t("code",[a._v("OpenJDK")]),a._v(". Następnie w drugim etapie uruchom jlink:")]),a._v(" "),t("div",{staticClass:"language-dockerfile extra-class"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Etap drugi (tworzenie JVM związanego z kodem)")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("FROM")]),a._v(" openjdk"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("11 AS JVM\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("ARG")]),a._v(" ES4X_VERSION=$"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("project.version"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Skopiuj build z poprzedniego etapu")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("COPY")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("from=NPM /usr/src/app /usr/src/app\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Użyj skopiowanego workspace'u")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("WORKDIR")]),a._v(" /usr/src/app\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Pobierz ES4X runtime")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("RUN")]),a._v(" curl "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("sL https"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("//github.com/reactiverse/es4x/releases/download/$"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("ES4X_VERSION"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("/es4x"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("pm"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("$"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("ES4X_VERSION"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("bin.tar.gz "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("|")]),a._v(" \\\n    tar zx "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("strip"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("components=1 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("C /usr/local\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Zainstaluj dependencje Javy")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Wymuś rozwiązanie es4x maven tylko dla dependencji produkcyjnych")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("RUN")]),a._v(" es4x install "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("only=prod\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Stwórz zoptymalizowany runtime")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("RUN")]),a._v(" es4x jlink "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("t /usr/local\n")])])]),t("p",[a._v("To stworzy zoptymalizowany runtime dla jre, który może zostać użyty z małym obrazem podstawowym dla ostatniego etapu:")]),a._v(" "),t("div",{staticClass:"language-dockerfile extra-class"},[t("pre",{pre:!0,attrs:{class:"language-dockerfile"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("FROM")]),a._v(" debian"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("slim\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Zbierz pliki jar z poprzedniego etapu")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("COPY")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("from=JVM /usr/local /usr/local\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("COPY")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("from=JVM /usr/src/app /usr/src/app\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Użyj skopiowanego workspace'u")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("WORKDIR")]),a._v(" /usr/src/app\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Bundle app source")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("COPY")]),a._v(" . .\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Zdefiniuj opcje javy dla kontenerów")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("ENV")]),a._v(" JAVA_OPTS="),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"-XX:+UnlockExperimentalVMOptions -XX:+UseCGroupMemoryLimitForHeap -XX:+UseContainerSupport"')]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# Zdefiniuj entrypoint")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("ENTRYPOINT")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"./node_modules/.bin/es4x-launcher"')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n")])])]),t("p",[a._v("Ten kod wyprodukuje mały obraz końcowy.")])])}),[],!1,null,null,null);e.default=n.exports}}]);